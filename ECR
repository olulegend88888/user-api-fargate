stage('Push Image to ECR') {
  steps {
    withCredentials([string(credentialsId: 'AWS_REPOSITORY_URL_SECRET', variable: 'AWS_ECR_URL')]) {
      withAWS(region: "${AWS_ECR_REGION}", credentials: 'personal-aws-ecr') {
        script {
          def login = ecrLogin()
          sh('#!/bin/sh -e\n' + "${login}") // hide logging
          docker.image("${AWS_ECR_URL}:${POM_VERSION}").push()
        }
      }
    }
  }
}
